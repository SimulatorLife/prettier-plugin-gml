#!/usr/bin/env sh
# husky pre-commit hook to format and lint code before committing.

if [ -z "${BASH_VERSION:-}" ]; then
	# Husky launches hooks with sh; re-exec under bash so nvm/formatter logic runs consistently.
	exec bash "$0" "$@"
fi

set -euo pipefail

repo_root="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$repo_root"

# Display current Node and npm versions
echo "Node: $(node -v)"
echo "npm:  $(npm -v)"

# Run format then lint (format first so lint --fix has less to do)
npm run format
npm run lint:fix

# Re-stage only modified tracked files in case formatters rewrote them
git add -u