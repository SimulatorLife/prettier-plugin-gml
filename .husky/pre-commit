#!/usr/bin/env bash
# husky pre-commit hook to format and lint code before committing.

set -euo pipefail

repo_root="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$repo_root"

# Ensure the correct Node version is active before running format/lint tasks.
# shellcheck disable=SC1091
. "$repo_root/scripts/ensure-node-version.sh"
ensure_node_version

# Display current Node and npm versions
echo "Node: $(node -v)"
echo "npm:  $(npm -v)"

# Run format then lint (format first so lint --fix has less to do)
npm run format
npm run lint:fix

# Re-stage only modified tracked files in case formatters rewrote them
git add -u