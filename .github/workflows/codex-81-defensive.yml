name: Codex – Defensive Input Hardening

on:
  schedule:
    - cron: "21 4 * * *"  # once a day at 04:21
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  run:
    uses: ./.github/workflows/_codex-open-pr-and-ping.yml
    secrets: inherit
    with:
      pr_title: "Codex: Defensive Input Hardening"
      pr_body: >
        Seed PR for Codex to reinforce defensive programming anywhere external
        data is accepted without validation or functions rely on `any`/loosely
        typed parameters. Tighten inputs before they can propagate invalid
        states.
      prompt: >
        Identify a concrete hotspot where we deserialize external data or call a
        function typed as `any`, `unknown`, or otherwise loosely typed without
        guarding the input shape. Implement a focused hardening layer that adds
        runtime validation, schema checks, or default value handling so that
        malformed payloads are rejected or normalized early. Update or add
        regression coverage capturing the failure before and the guarded path
        after. Keep the scope small—address one high-impact site with pragmatic
        validation while preserving existing API behaviour.
