name: Codex 22 – Bug Fix
on:
  repository_dispatch:
    types: [run_scheduled]
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  run:
    if: ${{ (github.event_name == 'workflow_dispatch' || (github.event_name == 'repository_dispatch' && github.event.action == 'run_scheduled' && github.event.client_payload.workflow_file == '.github/workflows/codex-22-bugfix.yml')) }}
    uses: ./.github/workflows/_codex-open-pr-and-ping.yml
    secrets: inherit
    with:
      pr_title: "Codex: Bug Fix"
      pr_body: "Seed PR for Codex to diagnose and fix a single bug."
      prompt: >
        Audit the codebase to identify one reproducible bug that impacts users, core
        functionality, performance, usability, etc. Confirm 
        the issue with a clear and reliable reproduction, then implement the smallest 
        safe fix that resolves it without introducing regressions or altering unrelated 
        behavior. Strengthen coverage by adding or improving automated tests to lock in 
        the fix. Keep the change set minimal, focused, and easy to review—deliver one 
        end-to-end, reliable bug fix rather than broad rewrites.
