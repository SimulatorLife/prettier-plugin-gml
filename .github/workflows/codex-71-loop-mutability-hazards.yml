name: Codex 71 – Loop Mutability Hazards
on:
  repository_dispatch:
    types: [run_scheduled]
  - cron: "27 4 4-31/2 * *"  # every 2 days at 04:27 (days 4,6,...)
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  run:
    if: ${{ (github.event_name == 'workflow_dispatch' || (github.event_name == 'repository_dispatch' && github.event.action == 'run_scheduled' && github.event.client_payload.workflow_file == '.github/workflows/codex-71-loop-mutability-hazards.yml')) }}
    uses: ./.github/workflows/_codex-open-pr-and-ping.yml
    secrets: inherit
    with:
      pr_title: "Codex: Loop Mutability Hazards"
      pr_body: >
        Seed PR for Codex to refactor a loop that mutates the collection it is
        iterating, preventing subtle data corruption or skipped entries.
      prompt: >
        Find a loop that modifies the iterable during traversal (e.g. push,
        splice, reusing references) or otherwise depends on mutation that risks
        skipping elements or sharing unintended state. Rewrite the logic to use
        a safer pattern — cloning, accumulation, or index-based iteration — and
        add tests that fail without the fix. Target a single representative bug
        and keep the refactor minimal while maintaining behaviour.
