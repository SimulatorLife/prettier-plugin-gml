name: Agent 83 â€“ Dependency Inversion Patrol (DIP)

on:
  workflow_dispatch:
    inputs:
      agent:
        description: "Optional agent override."
        required: false
        default: ""
        type: string

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  run:
    uses: ./.github/workflows/_agent-open-pr-and-ping.yml
    secrets: inherit
    with:
      agent: ${{ inputs.agent }}
      pr_title: "Agent: Dependency Inversion Guardrails"
      prompt: >
        Audit the high-level orchestration layers first: src/plugin/src/gml.js, the CLI entry
        point in src/cli/prettier-wrapper.js, and related glue modules that compose parser,
        printer, comment, or identifier-case subsystems. Search these files for the `new`
        keyword and for imports that pull concrete adapters from directories such as
        src/plugin/src/parsers/, src/plugin/src/printer/, or other low-level adapters. When you
        find a high-level module instantiating or importing a concrete implementation directly,
        treat it as a dependency inversion violation. Recommend (and implement when feasible)
        the right abstraction boundary by introducing interfaces, a provider registry, or
        constructor injection so the high-level code depends on abstractions instead of concrete
        adapters. Keep the refactor narrow and behaviour-preserving, update tests and docs as
        needed, and leave notes in the PR when follow-up work is required.
