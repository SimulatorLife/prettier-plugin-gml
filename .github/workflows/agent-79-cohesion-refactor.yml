name: "Agent 79 - Cohesion Refactor"

on:
  workflow_dispatch:
    inputs:
      agent:
        description: "Optional agent override."
        required: false
        default: ""
        type: string

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  run:
    uses: ./.github/workflows/_agent-open-pr-and-ping.yml
    secrets: inherit
    with:
      agent: ${{ inputs.agent }}
      pr_title: "Agent: Cohesion Refactor"
      prompt: >
        Hunt for fragmented helpers or duplicated utilities that should live together.
        Extract or merge them into a shared module with clear ownership so related code
        sits side-by-side. When minting a brand-new helper, strongly prefer situations
        where the function will be called at least three times and contain five or more
        lines of executable logic (excluding comments and blank lines) so the addition
        carries its weight, unless you have a well-supported reason to do otherwise.
        Update imports/exports accordingly and keep changes targeted to one cohesive
        slice of the project.

        Requirements:
          • Accept optional allow/deny path lists from workflow inputs. Honor them to avoid
            touching restricted directories.
          • Provide a migration note in the commit message summarizing renamed symbols, moved files,
            and how downstream extensions should adapt.
          • Run unit tests, lint, and formatting checks and record results in the commit message.
          • Avoid rewriting public APIs unless absolutely necessary; prefer drop-in
            replacements that reduce duplication.

        If no safe consolidation exists, describe the investigation in the commit message and
        propose a follow-up plan instead of submitting a noisy change.
